<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    
    .container {
      background-color: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      max-width: 500px;
      margin: 0 auto;
    }
    
    h2 {
      color: #1a73e8;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .warning-icon {
      font-size: 48px;
      text-align: center;
      margin-bottom: 20px;
    }
    
    .description {
      margin-bottom: 25px;
      color: #5f6368;
      line-height: 1.5;
      text-align: center;
    }
    
    .date-info {
      background-color: #f8f9fa;
      border: 1px solid #e8eaed;
      border-radius: 4px;
      padding: 20px;
      margin-bottom: 25px;
    }
    
    .date-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .date-row:last-child {
      margin-bottom: 0;
    }
    
    .date-label {
      font-weight: 500;
      color: #202124;
      min-width: 120px;
    }
    
    .date-value {
      color: #1a73e8;
      font-weight: 500;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      font-weight: 500;
      color: #202124;
      margin-bottom: 8px;
    }
    
    .form-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e8eaed;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }
    
    .form-input:focus {
      outline: none;
      border-color: #1a73e8;
    }
    
    .date-input-group {
      display: flex;
      gap: 15px;
    }
    
    .date-input {
      flex: 1;
    }
    
    .buttons {
      text-align: center;
      margin-top: 25px;
    }
    
    button {
      background-color: #1a73e8;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 0 10px;
      transition: background-color 0.3s ease;
    }
    
    button:hover {
      background-color: #1557b0;
    }
    
    button:disabled {
      background-color: #dadce0;
      cursor: not-allowed;
    }
    
    .secondary-btn {
      background-color: #5f6368;
    }
    
    .secondary-btn:hover {
      background-color: #3c4043;
    }
    
    .status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 4px;
      text-align: center;
      display: none;
    }
    
    .status.success {
      background-color: #e6f4ea;
      color: #137333;
      border: 1px solid #34a853;
    }
    
    .status.error {
      background-color: #fce8e6;
      color: #d93025;
      border: 1px solid #ea4335;
    }
    
    .loading {
      display: none;
      text-align: center;
      margin-top: 15px;
    }
    
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #1a73e8;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="warning-icon">⚠️</div>
    <h2>Campaign Date Confirmation</h2>
    
    <div class="description">
      Your campaign was configured on a different date. Please confirm or update your campaign dates before processing.
    </div>
    
    <div class="date-info">
      <div class="date-row">
        <span class="date-label">Today's Date:</span>
        <span class="date-value" id="todayDate"></span>
      </div>
      <div class="date-row">
        <span class="date-label">Configured Start:</span>
        <span class="date-value" id="configuredStart"></span>
      </div>
      <div class="date-row">
        <span class="date-label">Configured End:</span>
        <span class="date-value" id="configuredEnd"></span>
      </div>
    </div>
    
    <div class="form-group">
      <label class="form-label">Update Campaign Dates (Optional)</label>
      <div class="date-input-group">
        <div class="date-input">
          <label class="form-label" for="newStartDate">Start Date</label>
          <input type="date" id="newStartDate" class="form-input">
        </div>
        <div class="date-input">
          <label class="form-label" for="newEndDate">End Date</label>
          <input type="date" id="newEndDate" class="form-input">
        </div>
      </div>
    </div>
    
    <div class="buttons">
      <button onclick="continueWithCurrentDates()" class="secondary-btn">Continue with Current Dates</button>
      <button onclick="updateAndContinue()" id="updateBtn">Update & Continue</button>
    </div>
    
    <div class="loading" id="loading">
      <div class="spinner"></div>
      Updating dates and processing...
    </div>
    
    <div class="status" id="status"></div>
  </div>

  <script>
    let currentConfig = null;
    
    window.onload = function() {
      loadCurrentConfiguration();
    };
    
    function loadCurrentConfiguration() {
      google.script.run
        .withSuccessHandler(function(config) {
          currentConfig = config;
          displayCurrentDates(config);
        })
        .withFailureHandler(function(error) {
          showStatus('Error loading configuration: ' + error.message, 'error');
        })
        .getConfigurationValues();
    }
    
    function displayCurrentDates(config) {
      const today = new Date();
      const todayStr = today.toISOString().split('T')[0];
      
      document.getElementById('todayDate').textContent = formatDate(todayStr);
      document.getElementById('configuredStart').textContent = formatDate(config.campaignStartDate);
      document.getElementById('configuredEnd').textContent = formatDate(config.campaignEndDate);
      
      // Pre-fill the form with current dates
      document.getElementById('newStartDate').value = config.campaignStartDate;
      document.getElementById('newEndDate').value = config.campaignEndDate;
    }
    
    function formatDate(dateStr) {
      if (!dateStr) return 'Not set';
      const date = new Date(dateStr + 'T00:00:00');
      return date.toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
    }
    
    function continueWithCurrentDates() {
      showLoading(true);
      
      google.script.run
        .withSuccessHandler(function() {
          google.script.host.close();
        })
        .withFailureHandler(function(error) {
          showLoading(false);
          showStatus('Error: ' + error.message, 'error');
        })
        .continueWithProcessing();
    }
    
    function updateAndContinue() {
      const newStartDate = document.getElementById('newStartDate').value;
      const newEndDate = document.getElementById('newEndDate').value;
      
      if (!newStartDate || !newEndDate) {
        showStatus('Please select both start and end dates', 'error');
        return;
      }
      
      if (new Date(newStartDate) >= new Date(newEndDate)) {
        showStatus('End date must be after start date', 'error');
        return;
      }
      
      showLoading(true);
      hideStatus();
      
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            google.script.host.close();
          } else {
            showLoading(false);
            showStatus(result.message, 'error');
          }
        })
        .withFailureHandler(function(error) {
          showLoading(false);
          showStatus('Error: ' + error.message, 'error');
        })
        .updateCampaignDatesAndContinue(newStartDate, newEndDate);
    }
    
    function showLoading(show) {
      document.getElementById('loading').style.display = show ? 'block' : 'none';
      document.getElementById('updateBtn').disabled = show;
    }
    
    function showStatus(message, type) {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = message;
      statusDiv.className = 'status ' + type;
      statusDiv.style.display = 'block';
    }
    
    function hideStatus() {
      document.getElementById('status').style.display = 'none';
    }
  </script>
</body>
</html>
